"use strict"

/* RemoteNetClientInfo identifies the SSID address (and network information) of a tasmota device */

const {ClientInfo} = require('../drivers');

class RemoteNetClientInfo extends ClientInfo {
  constructor(opts) {
    super(opts);
    this.gotNet = false;
    this.gotSSID = false;
  }

  async parse(topic, payload) {
    switch (topic.toUpperCase()) {
      case "STATUS3":
        this._debug(`Got AP information`);
        this.info.SSID = payload.StatusLOG.SSId[0];
        this.gotSSID = true;
        break;
      case "STATUS5":
        this._debug(`Got network information`);
        this.info.Gateway = payload.StatusNET.Gateway;
        this.info.Subnetmask = payload.StatusNET.Subnetmask;
        this.gotNet = true;
        break;
    }

    if (this.gotNet && this.gotSSID) {
      this.emit('ready', this.info);
    }
  }

  async query() {
    return [{topic:'STATUS', payload: Buffer.from('3')},{topic:'STATUS', payload: Buffer.from('5')}];
  }

  get DBKey() {return 'SSID';}
}

module.exports = RemoteNetClientInfo;